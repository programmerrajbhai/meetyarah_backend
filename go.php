<?php
// à¦†à¦ªà¦¨à¦¾à¦° Adsterra Direct Link
$adsterra_link = "https://www.effectivegatecpm.com/n90473c2?key=8d080fc227ce9b5ddb7bd690437b6d2c";

// à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¬à§à¦°à¦¾à¦‰à¦œà¦¾à¦° à¦‡à¦¨à¦«à¦°à¦®à§‡à¦¶à¦¨ à¦¨à§‡à¦“à§Ÿà¦¾ (à¦¯à¦¾à¦¤à§‡ Adsterra à¦®à¦¨à§‡ à¦•à¦°à§‡ à¦à¦Ÿà¦¿ à¦°à¦¿à§Ÿà§‡à¦² à¦‡à¦‰à¦œà¦¾à¦°)
$user_agent = $_SERVER['HTTP_USER_AGENT'];

// cURL à¦¸à§‡à¦Ÿà¦†à¦ª (à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦¦à¦¿à§Ÿà§‡ à¦²à¦¿à¦‚à¦• à¦­à¦¿à¦œà¦¿à¦Ÿ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯)
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $adsterra_link);
curl_setopt($ch, CURLOPT_HEADER, true); // à¦¹à§‡à¦¡à¦¾à¦° à¦‡à¦¨à¦«à§‹ à¦¦à¦°à¦•à¦¾à¦°
curl_setopt($ch, CURLOPT_NOBODY, true); // à¦ªà§à¦°à§‹ à¦ªà§‡à¦œ à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à¦¾à¦° à¦¦à¦°à¦•à¦¾à¦° à¦¨à§‡à¦‡, à¦¶à§à¦§à§ à¦²à¦¿à¦‚à¦• à¦¦à¦°à¦•à¦¾à¦°
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // à¦¯à¦¤à¦—à§à¦²à§‹ à¦°à¦¿à¦¡à¦¾à¦‡à¦°à§‡à¦•à§à¦Ÿ à¦†à¦›à§‡ à¦¸à¦¬ à¦«à¦²à§‹ à¦•à¦°à¦¬à§‡
curl_setopt($ch, CURLOPT_MAXREDIRS, 10); // à¦¸à¦°à§à¦¬à§‹à¦šà§à¦š à§§à§¦ à¦¬à¦¾à¦° à¦°à¦¿à¦¡à¦¾à¦‡à¦°à§‡à¦•à§à¦Ÿ à¦šà§‡à¦• à¦•à¦°à¦¬à§‡
curl_setopt($ch, CURLOPT_USERAGENT, $user_agent); // à¦«à§‡à¦• à¦‡à¦‰à¦œà¦¾à¦° à¦à¦œà§‡à¦¨à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // SSL à¦à¦°à¦° à¦‡à¦—à¦¨à§‹à¦° à¦•à¦°à¦¬à§‡

// à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
$response = curl_exec($ch);

// à¦«à¦¾à¦‡à¦¨à¦¾à¦² à¦²à¦¿à¦‚à¦• (à¦†à¦¸à¦² à¦…à¦«à¦¾à¦° à¦ªà§‡à¦œ) à¦¬à§‡à¦° à¦•à¦°à¦¾
$final_destination = curl_getinfo($ch, CURLINFO_EFFECTIVE_URL);

curl_close($ch);

// ======================================================
// ðŸ”¥ à¦®à§à¦¯à¦¾à¦œà¦¿à¦• à¦ªà¦¾à¦°à§à¦Ÿ: AdGuard à¦¬à¦¾à¦‡à¦ªà¦¾à¦¸
// ======================================================

if ($final_destination && $final_destination != $adsterra_link) {
    // à¦¯à¦¦à¦¿ à¦†à¦®à¦°à¦¾ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§‡ à¦«à¦¾à¦‡à¦¨à¦¾à¦² à¦²à¦¿à¦‚à¦• (à¦¯à§‡à¦®à¦¨: PlayStore à¦¬à¦¾ Product Page) à¦ªà¦¾à¦‡
    // à¦¤à¦¬à§‡ à¦‡à¦‰à¦œà¦¾à¦°à¦•à§‡ à¦¸à¦°à¦¾à¦¸à¦°à¦¿ à¦¸à§‡à¦–à¦¾à¦¨à§‡ à¦ªà¦¾à¦ à¦¿à§Ÿà§‡ à¦¦à§‡à¦¬à¥¤
    // AdGuard à¦à¦‡ à¦«à¦¾à¦‡à¦¨à¦¾à¦² à¦²à¦¿à¦‚à¦•à¦Ÿà¦¿ à¦¬à§à¦²à¦• à¦•à¦°à¦¬à§‡ à¦¨à¦¾à¥¤
    header("Location: " . $final_destination);
} else {
    // à¦¯à¦¦à¦¿ à¦•à§‹à¦¨à§‹ à¦•à¦¾à¦°à¦£à§‡ à¦¸à¦¾à¦°à§à¦­à¦¾à¦° à¦²à¦¿à¦‚à¦• à¦¬à§‡à¦° à¦•à¦°à¦¤à§‡ à¦¨à¦¾ à¦ªà¦¾à¦°à§‡, 
    // à¦¤à¦¬à§‡ à¦®à§à¦¯à¦¾à¦¨à§à§Ÿà¦¾à¦² à¦œà¦¾à¦­à¦¾à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦®à§‡à¦¥à¦¡à§‡ à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à¦¬à§‡ (à¦¬à§à¦¯à¦¾à¦•à¦†à¦ª à¦ªà§à¦²à§à¦¯à¦¾à¦¨)
    echo '<script>window.location.href = "'.$adsterra_link.'";</script>';
}
exit();
?>